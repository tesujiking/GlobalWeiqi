<!-- 围棋等级分计算器 - 嵌入式版本 -->
<div style="padding: 60px; background: transparent;">
    <!-- 标题区域 -->
    <div style="text-align: center; margin-bottom: 40px;">
        <h1 style="font-size: 48px; font-weight: 800; background: linear-gradient(135deg, #667eea, #764ba2); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text; margin-bottom: 20px;">围棋等级分计算器</h1>
        <p style="font-size: 20px; color: #666; line-height: 1.6;">基于EGF官方算法，支持棋份调整的等级分与段位计算</p>
    </div>
    
    <!-- 输入表单 -->
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 30px; margin-bottom: 40px;">
        <div style="background: rgba(255, 255, 255, 0.8); border-radius: 16px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.1)'; this.style.background='rgba(255,255,255,0.95)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.background='rgba(255,255,255,0.8)';">
            <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #2c3e50; font-size: 18px;">⚫ 黑方等级分</label>
            <input type="number" id="blackRating" value="2100" style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; transition: all 0.3s ease;" onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)';" onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='none';">
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.8); border-radius: 16px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.1)'; this.style.background='rgba(255,255,255,0.95)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.background='rgba(255,255,255,0.8)';">
            <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #2c3e50; font-size: 18px;">⚪ 白方等级分</label>
            <input type="number" id="whiteRating" value="2100" style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; transition: all 0.3s ease;" onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)';" onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='none';">
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.8); border-radius: 16px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.1)'; this.style.background='rgba(255,255,255,0.95)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.background='rgba(255,255,255,0.8)';">
            <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #2c3e50; font-size: 18px;">🎯 让子数</label>
            <input type="number" id="handicap" value="0" min="0" max="9" style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; transition: all 0.3s ease;" onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)';" onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='none';">
        </div>
        
        <div style="background: rgba(255, 255, 255, 0.8); border-radius: 16px; padding: 30px; border: 1px solid rgba(255, 255, 255, 0.2); backdrop-filter: blur(10px); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 10px 30px rgba(0,0,0,0.1)'; this.style.background='rgba(255,255,255,0.95)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='none'; this.style.background='rgba(255,255,255,0.8)';">
            <label style="display: block; margin-bottom: 15px; font-weight: 700; color: #2c3e50; font-size: 18px;">🏆 比赛结果</label>
            <select id="gameResult" style="width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; transition: all 0.3s ease; background: white;" onfocus="this.style.borderColor='#667eea'; this.style.boxShadow='0 0 0 3px rgba(102,126,234,0.1)';" onblur="this.style.borderColor='#e9ecef'; this.style.boxShadow='none';">
                <option value="黑胜">⚫ 黑胜</option>
                <option value="白胜">⚪ 白胜</option>
                <option value="和棋">🤝 和棋</option>
            </select>
        </div>
    </div>
    
    <!-- 计算按钮 -->
    <div style="text-align: center; margin-bottom: 40px;">
        <button onclick="calculateRating()" style="padding: 20px 50px; background: linear-gradient(135deg, #ff6b6b, #ee5a24); color: white; border: none; border-radius: 50px; font-size: 18px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 8px 25px rgba(255, 107, 107, 0.4); display: inline-flex; align-items: center; gap: 10px;" onmouseover="this.style.transform='translateY(-3px)'; this.style.boxShadow='0 12px 35px rgba(255, 107, 107, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 8px 25px rgba(255, 107, 107, 0.4)';">
            🚀 计算新等级分与段位
        </button>
    </div>
    
    <!-- 结果显示区域 -->
    <div id="result" style="background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05)); padding: 40px; border-radius: 16px; border: 1px solid rgba(102, 126, 234, 0.1); min-height: 200px;">
        <div style="text-align: center; color: #666; font-size: 18px; padding: 40px;">📊 请输入参数并点击计算按钮</div>
    </div>
</div>

<script>
function calculateRating() {
    const r1 = parseFloat(document.getElementById('blackRating').value);
    const r2 = parseFloat(document.getElementById('whiteRating').value);
    const handicap = parseInt(document.getElementById('handicap').value);
    const result = document.getElementById('gameResult').value;
    
    if (isNaN(r1) || isNaN(r2) || isNaN(handicap)) {
        document.getElementById('result').innerHTML = '<div style="color: #e74c3c; text-align: center; font-size: 18px; padding: 40px;">❌ 请输入有效数字</div>';
        return;
    }
    
    // EGF算法
    let adjusted_r1 = handicap > 0 ? r1 + (handicap - 0.5) * 100 : r1;
    
    const beta = (r) => -7 * Math.log(Math.min(3300, 3299.9) - Math.min(r, 3299.9));
    const con = (r) => Math.pow((3300 - r) / 200, 1.6);
    const bonus = (r) => Math.log(1 + Math.exp((2300 - r) / 80)) / 5;
    
    const Se1 = 1 / (1 + Math.exp(beta(r2) - beta(adjusted_r1)));
    const Se2 = 1 - Se1;
    
    let Sa1, Sa2;
    if (result === '黑胜') [Sa1, Sa2] = [1.0, 0.0];
    else if (result === '白胜') [Sa1, Sa2] = [0.0, 1.0];
    else [Sa1, Sa2] = [0.5, 0.5];
    
    const new_r1 = r1 + con(r1) * (Sa1 - Se1) + bonus(r1);
    const new_r2 = r2 + con(r2) * (Sa2 - Se2) + bonus(r2);
    
    const change1 = (new_r1 - r1).toFixed(2);
    const change2 = (new_r2 - r2).toFixed(2);
    
    function getRank(rating) {
        if (rating >= 2050) {
            const level = Math.floor((rating - 2050) / 100) + 1;
            const decimal = Math.floor(((rating - 2050) % 100) / 10);
            return `${level}.${decimal}D`;
        } else {
            const level = Math.floor((2050 - rating) / 100) + 1;
            const decimal = Math.floor((2050 - (level - 1) * 100 - rating) / 10);
            return `${level}.${decimal}K`;
        }
    }
    
    const se1_percent = (Se1 * 100).toFixed(1);
    const se2_percent = (Se2 * 100).toFixed(1);
    
    document.getElementById('result').innerHTML = `
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; margin-bottom: 30px;">
            <div style="background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 16px; border-left: 5px solid #2c3e50; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 30px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0,0,0,0.1)';">
                <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 24px; font-weight: 700;">⚫ 黑方结果</h3>
                <div style="font-size: 16px; margin-bottom: 10px;">原等级分: <strong>${r1}</strong> (${getRank(r1)})</div>
                <div style="font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 10px;">新等级分: <strong>${new_r1.toFixed(2)}</strong> (${getRank(new_r1)})</div>
                <div style="font-size: 16px;">变化: <span style="color: ${change1 >= 0 ? '#27ae60' : '#e74c3c'}; font-weight: bold; font-size: 18px;">${change1 > 0 ? '+' : ''}${change1}</span></div>
            </div>
            <div style="background: rgba(255, 255, 255, 0.9); padding: 30px; border-radius: 16px; border-left: 5px solid #95a5a6; box-shadow: 0 4px 20px rgba(0,0,0,0.1); transition: all 0.3s ease;" onmouseover="this.style.transform='translateY(-5px)'; this.style.boxShadow='0 8px 30px rgba(0,0,0,0.15)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 20px rgba(0,0,0,0.1)';">
                <h3 style="margin: 0 0 20px 0; color: #2c3e50; font-size: 24px; font-weight: 700;">⚪ 白方结果</h3>
                <div style="font-size: 16px; margin-bottom: 10px;">原等级分: <strong>${r2}</strong> (${getRank(r2)})</div>
                <div style="font-size: 18px; font-weight: bold; color: #667eea; margin-bottom: 10px;">新等级分: <strong>${new_r2.toFixed(2)}</strong> (${getRank(new_r2)})</div>
                <div style="font-size: 16px;">变化: <span style="color: ${change2 >= 0 ? '#27ae60' : '#e74c3c'}; font-weight: bold; font-size: 18px;">${change2 > 0 ? '+' : ''}${change2}</span></div>
            </div>
        </div>
        <div style="text-align: center; background: rgba(255, 255, 255, 0.8); padding: 30px; border-radius: 16px; backdrop-filter: blur(10px);">
            <h3 style="color: #2c3e50; margin-bottom: 20px; font-size: 24px; font-weight: 700;">📈 预期胜率对比</h3>
            <div style="display: flex; height: 50px; border-radius: 25px; overflow: hidden; border: 2px solid rgba(102, 126, 234, 0.2); box-shadow: 0 4px 15px rgba(0,0,0,0.1);">
                <div style="background: linear-gradient(135deg, #2c3e50, #34495e); color: white; width: ${se1_percent}%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; transition: width 0.5s ease;">
                    黑方 ${se1_percent}%
                </div>
                <div style="background: linear-gradient(135deg, #95a5a6, #7f8c8d); color: white; width: ${se2_percent}%; display: flex; align-items: center; justify-content: center; font-size: 16px; font-weight: bold; transition: width 0.5s ease;">
                    白方 ${se2_percent}%
                </div>
            </div>
            <p style="margin-top: 15px; color: #666; font-size: 14px;">💡 数据基于EGF官方算法计算</p>
        </div>
    `;
    
    // 添加结果动画效果
    const resultDiv = document.getElementById('result');
    resultDiv.style.transform = 'scale(0.95)';
    resultDiv.style.transition = 'all 0.3s ease';
    setTimeout(() => {
        resultDiv.style.transform = 'scale(1)';
    }, 100);
}
</script>
