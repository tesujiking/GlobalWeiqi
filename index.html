<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全球围棋超级联赛</title>
    <meta name="description" content="全球围棋超级联赛">
    
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        /* 您之前的所有CSS样式都保持不变，这里为了简洁省略，请确保它们都在这里 */
        :root { --sidebar-width: 240px; --sidebar-bg: #262421; /* ... 等等 */ }
        body { font-family: 'Segoe UI', sans-serif; background-color: var(--main-bg); overflow-x: hidden; }
        .layout-wrapper { display: flex; }
        .sidebar { width: var(--sidebar-width); height: 100vh; position: fixed; top: 0; left: 0; background-color: var(--sidebar-bg); color: var(--sidebar-text); z-index: 1000; overflow-y: auto; transition: transform 0.3s ease-in-out; flex-shrink: 0; }
        .main-content-wrapper { flex-grow: 1; transition: transform 0.3s ease-in-out, margin-left 0.3s ease-in-out; width: 100%; }
        .top-bar { background-color: white; box-shadow: 0 1px 3px rgba(0,0,0,0.1); height: 64px; display: flex; align-items: center; justify-content: space-between; padding: 0 1.5rem; position: sticky; top: 0; z-index: 900; }
        #content-container { padding: 1.5rem; }
        .hamburger-button { display: none; }
        /* ... 其他所有样式 ... */
        @media (min-width: 1024px) {
            .main-content-wrapper { margin-left: var(--sidebar-width); width: calc(100% - var(--sidebar-width)); }
            /* ... 其他电脑端样式 ... */
        }
        @media (max-width: 1023px) {
            .hamburger-button { display: block; }
            .sidebar { transform: translateX(-100%); }
            body.sidebar-open .sidebar { transform: translateX(0); }
            .content-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 950; opacity: 0; visibility: hidden; transition: opacity 0.3s ease-in-out; }
            body.sidebar-open .content-overlay { opacity: 1; visibility: visible; }
            /* ... 其他移动端样式 ... */
        }
    </style>
</head>
<body>

<div class="layout-wrapper">
    <nav class="sidebar" id="sidebar">
        <div class="sidebar-header hidden lg:flex justify-center p-4">
            <img src="./images/GlobalWeiqi.png" alt="Logo" class="sidebar-logo h-10">
        </div>
        <ul class="menu" id="main-menu">
            <li class="has-submenu">
                <a href="#">比赛信息</a>
                <ul class="submenu">
                    <li><a href="/standings/s1" data-nav-link>第1期（已结束）</a></li>
                    <li class="has-submenu">
                        <a href="#">第2期（进行中）</a>
                        <ul class="submenu-3">
                            <li><a href="/standings/s2" data-nav-link>排行榜</a></li>
                            <li><a href="/games/s2/r4" data-nav-link>第4轮对局</a></li>
                        </ul>
                    </li>
                </ul>
            </li>
            <li><a href="/rating-history" data-nav-link>会员名录</a></li>
            <li><a href="/register" data-nav-link style="color: #ef4444;">马上报名</a></li>
            <li><a href="/calculator" data-nav-link>计算器</a></li>
        </ul>
    </nav>
    
    <div class="main-content-wrapper" id="main-content-wrapper">
        <header class="top-bar">
            <div class="flex items-center">
                <button class="hamburger-button" id="hamburger-button">
                    <span class="bar"></span><span class="bar"></span><span class="bar"></span>
                </button>
                <div class="flex items-center gap-3 lg:hidden">
                    <img src="./images/GlobalWeiqi.png" alt="Logo" class="h-8">
                    <span class="text-lg font-bold">全球围棋超级联赛</span>
                </div>
            </div>
            <div id="top-bar-user-status"></div>
        </header>

        <main id="content-container">
            </main>
    </div>
    
    <div class="content-overlay" id="content-overlay"></div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        const contentContainer = document.getElementById('content-container');
        const mainMenu = document.getElementById('main-menu');
        const hamburgerButton = document.getElementById('hamburger-button');
        const contentOverlay = document.getElementById('content-overlay');

        // --- 1. 路由配置：将URL路径映射到实际的HTML“碎片”文件 ---
        const routes = {
            '/': 'home.html', // 根路径
            '/rating-history': 'ratinghistory.html',
            '/register': 'register.html',
            '/calculator': 'calculator.html',
            '/standings/s2': 'standingsS2R4.html',
            // ... 在这里为您所有的页面添加路由 ...
        };

        // --- 2. 核心函数：加载并显示内容 ---
        async function loadContent(path) {
            // 根据路径找到对应的文件名，如果找不到，则默认加载首页
            const pageFile = routes[path] || routes['/'];
            
            if (!pageFile) {
                contentContainer.innerHTML = '<h1>404 - 页面未找到</h1>';
                return;
            }

            try {
                contentContainer.innerHTML = '<p class="text-center p-10">正在加载...</p>';
                const response = await fetch(pageFile);
                if (!response.ok) throw new Error('页面加载失败');
                
                const html = await response.text();
                contentContainer.innerHTML = html;
            } catch (error) {
                contentContainer.innerHTML = `<p class="text-center p-10 text-red-500">加载内容时出错: ${error.message}</p>`;
            }
        }

        // --- 3. 事件监听 ---
        
        // 监听所有带 data-nav-link 属性的链接点击
        document.body.addEventListener('click', e => {
            const link = e.target.closest('a[data-nav-link]');
            if (link) {
                e.preventDefault(); // 阻止浏览器默认的跳转行为
                const path = link.getAttribute('href');
                
                // 更新浏览器地址栏，但不刷新页面
                history.pushState({ path: path }, '', path);
                
                // 加载新内容
                loadContent(path);

                // 如果是移动端，自动关闭菜单
                if (document.body.classList.contains('sidebar-open')) {
                    document.body.classList.remove('sidebar-open');
                }
            }
        });

        // 监听浏览器前进/后退按钮
        window.addEventListener('popstate', e => {
            loadContent(location.pathname);
        });
        
        // 汉堡菜单的交互逻辑
        function toggleMenu() {
            document.body.classList.toggle('sidebar-open');
        }
        hamburgerButton.addEventListener('click', e => {
            e.stopPropagation();
            toggleMenu();
        });
        contentOverlay.addEventListener('click', toggleMenu);
        
        // (您原有的多级菜单展开JS、登录检查JS等逻辑可以保留在这里)

        // --- 4. 初始加载 ---
        // 页面第一次打开时，加载与当前URL匹配的内容
        loadContent(window.location.pathname);
    });
</script>

</body>
</html>
