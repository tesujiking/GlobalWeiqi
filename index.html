<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
    <meta name="description" content="全球围棋超级联赛">

    <title>这里是你的网页标题</title>
    <meta property="og:title" content="全球围棋超级联赛" />
    <meta property="og:description" content="全名参与，高手云集，新手友好，真正涨棋的全球围棋超级联赛" />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://www.globalweiqi.com/index.html" />
    <meta property="og:image" content="https://www.globalweiqi.com/images/GlobalWeiqi.png" />
    <link rel="stylesheet" href="style.css">


  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background-color: #f9f9f9;
    }

    .site-header {
      background-color: #f8f8f8;
      padding: 20px;
      border-bottom: 1px solid #ccc;
    }

    .logo-link {
      display: flex;
      align-items: center;
      text-decoration: none;
      gap: 15px;
    }

    .site-logo {
      height: 60px;
      width: auto;
    }

    .site-title {
      font-size: 28px;
      font-weight: bold;
      color: #222;
    }

    nav {
      background-color: #222;
    }

    .menu {
      display: flex;
      list-style: none;
      padding-left: 20px;
    }

    .menu > li {
      position: relative;
    }

    .menu > li > a {
      display: block;
      color: #fff;
      padding: 16px 20px;
      text-decoration: none;
      font-weight: 500;
    }

    .menu > li:hover {
      background-color: #333;
    }

    .submenu {
      display: none;
      position: absolute;
      background-color: #333;
      top: 100%;
      left: 0;
      min-width: 180px;
      z-index: 100;
    }

    /* 桌面端鼠标悬停显示子菜单 */
    @media (hover: hover) and (pointer: fine) {
      .menu li:hover > .submenu {
        display: block;
      }
      .has-submenu:hover > .submenu-3 {
        display: block;
      }
    }

    /* 移动端点击显示子菜单 */
    .submenu.active {
      display: block !important;
    }

    .submenu li {
      position: relative;
    }

    .submenu li a {
      display: block;
      color: white;
      padding: 12px 16px;
      text-decoration: none;
    }

    .submenu li a:hover {
      background-color: #444;
    }

    /* 三级菜单 */
    .submenu-3 {
      display: none;
      position: absolute;
      top: 0;
      left: 100%;
      background-color: #444;
      min-width: 180px;
      z-index: 200;
    }

    .submenu-3.active {
      display: block !important;
    }

    /* 移动端适配 */
    @media (max-width: 768px) {
      .menu {
        flex-direction: column;
        padding-left: 0;
      }
      
      .menu > li {
        border-bottom: 1px solid #444;
      }
      
      .submenu {
        position: static !important;
        background-color: #444;
        min-width: auto;
        box-shadow: inset 0 0 10px rgba(0,0,0,0.2);
      }
      
      .submenu-3 {
        position: static !important;
        background-color: #555;
        margin-left: 20px;
      }
      
      /* 为有子菜单的项目添加下拉箭头 */
      .menu > li.has-submenu > a::after {
        content: ' ▼';
        font-size: 12px;
        transition: transform 0.3s;
        float: right;
      }
      
      .menu > li.has-submenu.active > a::after {
        transform: rotate(180deg);
      }
      
      .submenu li.has-submenu > a::after {
        content: ' ►';
        font-size: 10px;
        float: right;
      }
      
      .submenu li.has-submenu.active > a::after {
        content: ' ▼';
        transform: none;
      }
    }

    iframe {
      width: 100%;
      height: calc(100vh - 140px); /* 调整高度：顶部 header + nav */
      border: none;
    }
  </style>
<style>
    #nav-user-status {
        position: absolute;
        top: 20px;
        right: 20px;
        font-size: 16px;
    }
    #nav-user-status a {
        cursor: pointer;
        color: #007bff;
        text-decoration: none;
        margin-left: 15px;
    }
    #nav-user-status a:hover {
        text-decoration: underline;
    }
</style>

</head>
<body>

  <!-- 顶部 Logo 和标题 -->
  <header class="site-header">
    <a href="index.html" class="logo-link">
      <img src="./images/GlobalWeiqi.png" alt="Global Weiqi Logo" class="site-logo">
      <span class="site-title">全球围棋超级联赛 Global Weiqi Super League</span>
    </a>
    <div id="nav-user-status"></div>
  </header>

  <!-- 主导航菜单 -->
<nav>
    <ul class="menu">
      <li class="has-submenu">
        <a href="#">比赛信息</a>
        <ul class="submenu">
          <li><a href="standingsS1R5.html" target="content-frame">第1期（已结束）</a></li>
          <li class="has-submenu">
            <a href="#">第2期（进行中）</a>
            <ul class="submenu-3">
              <li><a href="standingsS2R4.html" target="content-frame">排行榜</a></li>
              <li><a href="GamesListS2R4.html" target="content-frame">第4轮对局</a></li>
            </ul>
          </li>
        </ul>
      </li>
      <li class="has-submenu">
        <a href="#">重要说明</a>
        <ul class="submenu">
          <li><a href="regulations.html" target="content-frame">比赛章程</a></li>
          <li><a href="deposit.html" target="content-frame">保证金</a></li>
          <li><a href="Review.html" target="content-frame">复盘讲解</a></li>
          <li><a href="Mcmahon.html" target="content-frame">麦克马洪编排</a></li>
          <li><a href="play.html" target="content-frame">下棋</a></li>
          <li><a href="board.html" target="content-frame">对弈棋盘</a></li>
          <li><a href="pairing_flow.html" target="content-frame">分区流动</a></li>
          <li><a href="flow_test.html" target="content-frame">流动测试</a></li>
          <li><a href="api_debug.html" target="content-frame">API调试</a></li>
          <li><a href="mobile_menu_test.html" target="content-frame">菜单测试</a></li>
          <li><a href="menu_debug.html" target="content-frame">菜单调试</a></li>
          <li><a href="login.html" target="content-frame">登陆</a></li>
          <li><a href="zhuce.html" target="content-frame">注册</a></li>
        </ul>
      </li>
      
      <li>
        <a href="ratinghistory.html" target="content-frame">会员名录</a>
      </li>
      
      <li>
        <a href="register.html" target="content-frame" style="color: red; font-weight: bold;">马上报名</a>
      </li>

      <li>
        <a href="calculator.html" target="content-frame">计算器</a>
      </li>
    </ul>
</nav>

  <!-- 主内容 iframe 区域 -->
  <iframe src="home.html" name="content-frame"></iframe>

  <script>
    const API_BASE_URL = 'https://yaoshen.pythonanywhere.com/api';
    const userStatusDiv = document.getElementById('nav-user-status');
    const contentFrame = document.querySelector('iframe[name="content-frame"]');

    // 移动端菜单管理
    function initMobileMenu() {
        // 检测是否为移动设备或小屏幕
        const isMobile = /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) || 
                        window.innerWidth <= 768 || 
                        ('ontouchstart' in window);
        
        console.log('Is mobile device:', isMobile, 'Screen width:', window.innerWidth);
        
        if (isMobile) {
            console.log('初始化移动端菜单');
            
            // 为一级菜单项目添加点击事件
            const menuItems = document.querySelectorAll('.menu > li.has-submenu');
            console.log('找到一级菜单项目:', menuItems.length);
            
            menuItems.forEach((item, index) => {
                const submenu = item.querySelector('.submenu');
                const mainLink = item.querySelector('> a');
                
                if (submenu && mainLink) {
                    console.log(`设置一级菜单 ${index + 1} 的点击事件`);
                    
                    // 移除可能已存在的事件监听器
                    mainLink.removeEventListener('click', handleMenuClick);
                    
                    // 添加点击事件
                    mainLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        console.log('点击了一级菜单:', mainLink.textContent.trim());
                        
                        // 关闭其他所有一级子菜单
                        document.querySelectorAll('.menu > li.has-submenu').forEach(otherItem => {
                            if (otherItem !== item) {
                                const otherSubmenu = otherItem.querySelector('.submenu');
                                if (otherSubmenu) {
                                    otherSubmenu.classList.remove('active');
                                    otherItem.classList.remove('active');
                                }
                            }
                        });
                        
                        // 关闭所有三级菜单
                        document.querySelectorAll('.submenu-3.active').forEach(submenu3 => {
                            submenu3.classList.remove('active');
                            submenu3.parentElement.classList.remove('active');
                        });
                        
                        // 切换当前子菜单
                        const isActive = submenu.classList.contains('active');
                        if (isActive) {
                            submenu.classList.remove('active');
                            item.classList.remove('active');
                            console.log('关闭子菜单');
                        } else {
                            submenu.classList.add('active');
                            item.classList.add('active');
                            console.log('打开子菜单');
                        }
                    });
                }
            });
            
            // 为二级菜单中的三级菜单项目添加点击事件
            const submenuItems = document.querySelectorAll('.submenu li.has-submenu');
            console.log('找到二级菜单项目:', submenuItems.length);
            
            submenuItems.forEach((item, index) => {
                const submenu3 = item.querySelector('.submenu-3');
                const submenuLink = item.querySelector('> a');
                
                if (submenu3 && submenuLink) {
                    console.log(`设置二级菜单 ${index + 1} 的点击事件`);
                    
                    submenuLink.addEventListener('click', function(e) {
                        e.preventDefault();
                        e.stopPropagation();
                        
                        console.log('点击了二级菜单:', submenuLink.textContent.trim());
                        
                        // 关闭其他三级菜单
                        document.querySelectorAll('.submenu-3.active').forEach(otherSubmenu3 => {
                            if (otherSubmenu3 !== submenu3) {
                                otherSubmenu3.classList.remove('active');
                                otherSubmenu3.parentElement.classList.remove('active');
                            }
                        });
                        
                        // 切换当前三级菜单
                        const isActive = submenu3.classList.contains('active');
                        if (isActive) {
                            submenu3.classList.remove('active');
                            item.classList.remove('active');
                            console.log('关闭三级菜单');
                        } else {
                            submenu3.classList.add('active');
                            item.classList.add('active');
                            console.log('打开三级菜单');
                        }
                    });
                }
            });
            
            // 点击子菜单项目后自动关闭菜单
            document.querySelectorAll('.submenu a[target="content-frame"], .submenu-3 a[target="content-frame"]').forEach(link => {
                link.addEventListener('click', function() {
                    console.log('点击了菜单项目:', this.textContent.trim());
                    // 延迟关闭菜单，给用户一个视觉反馈
                    setTimeout(() => {
                        document.querySelectorAll('.submenu.active, .submenu-3.active').forEach(activeSubmenu => {
                            activeSubmenu.classList.remove('active');
                        });
                        document.querySelectorAll('.menu li.active').forEach(activeItem => {
                            activeItem.classList.remove('active');
                        });
                        console.log('自动关闭所有菜单');
                    }, 150);
                });
            });
            
            // 点击外部区域关闭菜单
            document.addEventListener('click', function(e) {
                if (!e.target.closest('nav')) {
                    console.log('点击外部区域，关闭所有菜单');
                    document.querySelectorAll('.submenu.active, .submenu-3.active').forEach(activeSubmenu => {
                        activeSubmenu.classList.remove('active');
                    });
                    document.querySelectorAll('.menu li.active').forEach(activeItem => {
                        activeItem.classList.remove('active');
                    });
                }
            });
        }
    }

    function checkLoginStatus() {
        fetch(`${API_BASE_URL}/status/`, { credentials: 'include' })
            .then(response => response.json())
            .then(data => {
                if (data.logged_in) {
                    userStatusDiv.innerHTML = `
                        <span>欢迎您, ${data.user.name || '会员'} (ID: ${data.user.member_id})</span>
                        <a id="logout-link">退出登录</a>
                    `;
                    document.getElementById('logout-link').addEventListener('click', handleLogout);
                } else {
                    userStatusDiv.innerHTML = `
                        <a href="login.html" target="content-frame">登录</a>
                        <a href="zhuce.html" target="content-frame">注册</a>
                    `;
                }
            });
    }

    function handleLogout() {
        fetch(`${API_BASE_URL}/logout/`, { method: 'POST', credentials: 'include' })
            .then(res => res.json())
            .then(data => {
                if(data.success) {
                    alert('您已成功退出。');
                    checkLoginStatus(); // 更新UI
                    contentFrame.src = "home.html"; // 退出后，主内容区返回首页
                }
            });
    }

    // 监听来自iframe的消息，在登录或注册成功后刷新状态
    window.addEventListener("message", (event) => {
        if (event.data === "loginSuccess" || event.data === "registrationSuccess") {
            checkLoginStatus();
        }
    });

    // 页面加载时立即执行
    document.addEventListener('DOMContentLoaded', function() {
        checkLoginStatus();
        initMobileMenu();
    });
    
    // 窗口大小改变时重新初始化菜单
    window.addEventListener('resize', function() {
        // 清除所有活动状态
        document.querySelectorAll('.submenu.active, .submenu-3.active').forEach(activeSubmenu => {
            activeSubmenu.classList.remove('active');
        });
        document.querySelectorAll('.menu li.active').forEach(activeItem => {
            activeItem.classList.remove('active');
        });
        
        // 重新初始化
        setTimeout(initMobileMenu, 100);
    });
</script>

</body>
</html>
