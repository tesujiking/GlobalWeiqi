<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>第一期全球围棋超级联赛 - 最终排名</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif; }
        .fade-in { animation: fadeIn 0.5s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        /* 增加更细的表格线 */
        th, td { border-bottom-width: 1px; }
        thead th { border-bottom-width: 2px; }
    </style>
</head>
<body class="bg-gray-100">

    <div class="container mx-auto px-4 py-8">
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800">第一期全球围棋超级联赛</h1>
            <h2 class="text-2xl text-gray-600 mt-2">最终排名公告</h2>
        </div>

        <div id="loading" class="text-center text-gray-500 py-10">
            <p>正在从服务器加载最终排名数据，请稍候...</p>
        </div>

        <div id="error" class="hidden text-center text-red-600 bg-red-100 p-4 rounded-lg my-4">
            <p id="error-message"></p>
        </div>

        <div id="standings-table" class="hidden bg-white p-6 rounded-lg shadow-lg">
            <div class="overflow-x-auto border rounded-lg">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 text-xs uppercase text-gray-500">
                        <tr>
                            <th class="px-2 py-3 text-left">序号</th>
                            <th class="px-2 py-3 text-left">名次</th>
                            <th class="px-4 py-3 text-left">姓名/城市</th>
                            <th class="px-3 py-3 text-center">段位</th>
                            <th class="px-3 py-3 text-center">胜局</th>
                            
                            <th class="px-2 py-3 text-center">第1轮</th>
                            <th class="px-2 py-3 text-center">第2轮</th>
                            <th class="px-2 py-3 text-center">第3轮</th>
                            <th class="px-2 py-3 text-center">第4轮</th>
                            <th class="px-2 py-3 text-center">第5轮</th>
                            <th class="px-3 py-3 text-center">MMS</th>
                            <th class="px-3 py-3 text-center">SOS</th>
                            <th class="px-3 py-3 text-center">SOSOS</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body" class="bg-white divide-y divide-gray-200 text-sm">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const TOURNAMENT_ID = 1; 
            const API_URL = `https://yaoshen.pythonanywhere.com/api/tournament/${TOURNAMENT_ID}/final_standings/`;

            const loadingDiv = document.getElementById('loading');
            const errorDiv = document.getElementById('error');
            const errorMessage = document.getElementById('error-message');
            const tableDiv = document.getElementById('standings-table');
            const tableBody = document.getElementById('standings-body');

            fetch(API_URL)
                .then(response => {
                    if (!response.ok) throw new Error(`网络错误 (状态码: ${response.status})`);
                    return response.json();
                })
                .then(data => {
                    if (data.error) throw new Error(data.error);

                    loadingDiv.style.display = 'none';

                    let tableRowsHtml = '';
                    if (data.standings && data.standings.length > 0) {
                        data.standings.forEach((player, index) => {
                            // 将轮次结果数组转换为<td>元素
                            let resultsHtml = '';
                            if(player.results_list) {
                                player.results_list.forEach(res => {
                                    resultsHtml += `<td class="px-2 py-3 text-center font-mono text-gray-600">${res}</td>`;
                                });
                            }

                            tableRowsHtml += `
                                <tr class="hover:bg-gray-50">
                                    <td class="px-2 py-3 font-medium text-gray-500">${index + 1}</td>
                                    <td class="px-2 py-3 font-bold text-center">${player.rank}</td>
                                    <td class="px-4 py-3 font-semibold text-gray-800">
                                        ${player.playerName}
                                        <span class="block text-xs font-normal text-gray-500">${player.city}</span>
                                    </td>
                                    <td class="px-3 py-3 text-center text-gray-700">${player.tournament_rank}</td>
                                    <td class="px-3 py-3 text-center font-bold text-blue-600">${player.wins}</td>
                                    
                                    ${resultsHtml}

                                    <td class="px-3 py-3 text-center font-bold text-indigo-600">${player.mms}</td>
                                    <td class="px-3 py-3 text-center text-gray-700">${player.sos}</td>
                                    <td class="px-3 py-3 text-center text-gray-700">${player.sosos}</td>
                                </tr>
                            `;
                        });
                        tableBody.innerHTML = tableRowsHtml;
                        tableDiv.classList.remove('hidden');
                        tableDiv.classList.add('fade-in');
                    } else {
                        throw new Error('未找到排名数据。');
                    }
                })
                .catch(error => {
                    console.error('加载排名数据失败:', error);
                    loadingDiv.style.display = 'none';
                    errorMessage.textContent = `加载排名数据失败: ${error.message}`;
                    errorDiv.classList.remove('hidden');
                });
        });
    </script>

</body>
</html>
